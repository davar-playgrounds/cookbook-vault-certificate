sudo: required

services:
  - docker

language: ruby

rvm:
  - 2.4
 
before_script:
 - docker run --cap-add=IPC_LOCK -d --name=dev-vault -p 8200:8200 vault
 - VAULT_CONTAINER_ID=`docker inspect --format="{{.Id}}" dev-vault`
 - echo $VAULT_CONTAINER_ID
 - docker logs `docker inspect --format="{{.Id}}" dev-vault`
 - docker logs $VAULT_CONTAINER_ID
 - VAULT_ROOT_TOKEN=`docker logs $VAULT_CONTAINER_ID | grep -Po "(?<=Root Token. )([^\n]+)"`
 - export VAULT_CONTAINER_ID
 - export VAULT_ROOT_TOKEN
 # Mount the secret and pki backends
 # Populate vault with some data
  
script:
 - echo "Container ID: $VAULT_CONTAINER_ID"
 - echo "Root Token: $VAULT_ROOT_TOKEN"
 - foodcritic -f any .
 - cookstyle -D
 - kitchen converge all
